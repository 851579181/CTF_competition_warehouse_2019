function POW(t,o){var s=2,e=this,i=!1,r=[],n=0;this.key="";var a=io.connect(t);a.on("new_work",function(t,o){i&&e.newWork(t,o)}),a.on("work_done",function(t){e.workProgressCallback&&i&&t>n&&(n=t,e.workProgressCallback.apply(e,[t])),i&&t>=e.workLimit&&(i=!1,a.emit("done",e.key,e.bid),e.doneCallback&&e.doneCallback.apply(e,[]))});for(var k=0;s>k;k++){var c=new Worker(o);c.postMessage({cmd:"set_id",id:k}),r.push(c)}for(var h=function(t){"getwork"==t.data.cmd&&i&&a.emit("getwork",t.data.id),"solved"==t.data.cmd&&a.emit("hash",t.data.h,t.data.id,e.key,e.bid)},d=0;d<r.length;d++)r[d].onmessage=h;this.newWork=function(t,o){r[o].postMessage({cmd:"new_work",work:t})},this.startWorkers=function(){for(var t=0;t<r.length;t++)r[t].postMessage({cmd:"start"})},this.stopWorkers=function(){for(var t=0;t<r.length;t++)r[t].postMessage({cmd:"stop"})},this.setKey=function(t){this.key=t},this.setDoneCallback=function(t){this.doneCallback=t},this.setWorkProgressCallback=function(t){this.workProgressCallback=t},this.setLimit=function(t){this.workLimit=t},this.work=function(t){n=0,this.bid=t,i=!0,this.startWorkers()},this.stop=function(){i=!1,this.stopWorkers()}}if(!Worker){var Worker=function(scriptFile){var self=this;var __timer=null;var __text=null;var __fileContent=null;var onmessage;self.onerror=null;self.onmessage=null;var postMessage=function(text){if("function"==typeof self.onmessage){return self.onmessage({data:text})}return false};self.postMessage=function(text){__text=text;__iterate();return true};var __iterate=function(){__timer=setTimeout(__onIterate,1);return true};var __onIterate=function(){try{if("function"==typeof onmessage){onmessage({data:__text})}return true}catch(ex){if("function"==typeof self.onerror){return self.onerror(ex)}}return false};self.terminate=function(){clearTimeout(__timer);return true};var getHTTPObject=function(){var xmlhttp;try{xmlhttp=new XMLHttpRequest}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){xmlhttp=false}}return xmlhttp};var http=getHTTPObject();http.open("GET",scriptFile,false);http.send(null);if(http.readyState==4){var strResponse=http.responseText;switch(http.status){case 404:alert("Error: Not Found. The requested function could not be found.");break;case 500:alert(strResponse);break;default:__fileContent=strResponse;eval(__fileContent);break}}self.importScripts=function(src){var script=document.createElement("SCRIPT");script.src=src;script.setAttribute("type","text/javascript");document.getElementsByTagName("HEAD")[0].appendChild(script);return true};return true}}(function(){var iframeHost=window.location.host;var serverUrl=iframeHost;var pow=new POW(serverUrl,"/js/libs/pow/pow.worker.min.js");var guid=window.location.search.replace(/^\?/,"");window.addEventListener("message",receiveMessage,false);function receiveMessage(e){var host=e.source;var data=e.data;try{data=typeof data==="string"?JSON.parse(data):data}catch(exception){return postError(host,"Data should be properly encoded json object")}switch(data.type){case"calculate":calculateHashcash(host,data);break}}function calculateHashcash(host,d){if(!d.key||!d.id||!d.limit){return postError(host,"key, id and limit are required to calculate proof of work")}pow.setKey(d.key);pow.setLimit(d.limit);pow.setDoneCallback(function(){sendToParent(host,{type:"done"})});pow.setWorkProgressCallback(function(totalDone){sendToParent(host,{type:"progress",totalDone:totalDone})});pow.work(d.id)}function postError(host,error){sendToParent(host,{type:"error",message:error},"*")}function sendToParent(target,message){message.guid=guid;target.postMessage(message,"*")}sendToParent(window.parent,{type:"ready"})})(this);