(function(root,factory){if(typeof define==="function"&&define.amd){define(function(){return root.HashcashIO=factory(root)})}else{root.HashcashIO=factory(root)}})(this,function(global){return function(options){var instance=this;var iframeGuid=guid();var iframeUrl=options.hashcashUrl+"/iframe.html?"+iframeGuid;global.addEventListener("message",receiveMessage,false);var iframe=document.createElement("iframe");iframe.src=iframeUrl;iframe.style.height=0;iframe.style.width=0;iframe.style.border="none";iframe.style.position="absolute";document.body.appendChild(iframe);var doneCb,progressCb;this.calculate=function(params){doneCb=params.done;progressCb=params.progress;iframe.contentWindow.postMessage({type:"calculate",key:params.publicKey,id:params.id,limit:params.limit},"*")};function receiveMessage(e){var data=e.data;try{data=typeof data==="string"?JSON.parse(data):data}catch(exception){return}if(data.guid!=iframeGuid){return}if(data.type=="error"){throw new Error(data.message)}switch(data.type){case"done":doneCb.apply(instance,[]);break;case"progress":progressCb.apply(instance,[data.totalDone]);break;case"ready":if(options.readyCb){options.readyCb.apply(instance,[])}break;default:throw new Error("Unimplemented iframe message")}}function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function guid(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}}});